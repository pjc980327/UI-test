<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¹„íŒ€ ë¬¸ì„œíƒìƒ‰ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #f5f7fa; --sidebar-bg: #ffffff; --text-color: #333;
            --border-color: #e2e8f0; 
            --accent-color: #20c997; /* ìš”ì²­í•˜ì‹  ë¶€ë“œëŸ¬ìš´ ì´ˆë¡/í‘¸ë¥¸ìƒ‰ (Teal) */
            --user-bubble-bg: #E8F5E9; /* ì§ˆë¬¸ ë¸”ëŸ­ ë¶€ë“œëŸ¬ìš´ ìƒ‰ìƒ */
            --ai-bubble-bg: transparent;
            --card-bg: #ffffff;
        }
        body.dark {
            --bg-color: #1a202c; --sidebar-bg: #2d3748; --text-color: #ecf0f1;
            --border-color: #4a5568; --accent-color: #4fd1c5;
            --user-bubble-bg: #285e61;
            --card-bg: #2d3748;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-color); color: var(--text-color); height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* ì¸ì¦ í™”ë©´ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€) */
        .auth-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        body.dark .auth-wrapper { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .auth-box { background: var(--card-bg); padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .auth-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; background: var(--bg-color); color: var(--text-color); }
        .btn-primary { width: 100%; padding: 14px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-secondary { background: transparent; border: 1px solid #ccc; color: #666; width: 100%; padding: 10px; border-radius: 8px; margin-top: 10px; cursor: pointer; }
        
        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .app-layout { display: flex; height: 100vh; width: 100vw; transition: all 0.5s ease; }
        
        /* ì‚¬ì´ë“œë°” */
        .sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; transition: width 0.3s ease; position: relative; z-index: 100; }
        .sidebar.collapsed { width: 60px; }
        .sidebar-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .sidebar-toggle-btn { cursor: pointer; font-size: 20px; color: var(--text-color); }
        .new-chat-btn { margin: 0 15px 20px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: transparent; color: var(--text-color); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .new-chat-btn:hover { background: var(--bg-color); border-color: var(--accent-color); color: var(--accent-color); }
        .sidebar.collapsed .new-chat-btn span { display: none; }
        
        /* íˆìŠ¤í† ë¦¬ ë¦¬ìŠ¤íŠ¸ & íˆ´íŒ */
        .history-list { flex: 1; overflow-y: auto; padding: 10px; }
        .history-item { 
            padding: 12px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; 
            font-size: 14px; white-space: nowrap; overflow: hidden; 
            position: relative; animation: slideInLeft 0.3s ease;
            transition: background 0.2s; 
        }
        .history-item:hover { background: var(--bg-color); }
        .history-item:hover::after {
            content: attr(data-tooltip); 
            position: absolute; left: 100%; top: 50%; transform: translateY(-50%);
            background: rgba(0,0,0,0.8); color: #fff; padding: 6px 10px; 
            border-radius: 4px; font-size: 12px; white-space: pre-line; z-index: 999;
            margin-left: 10px; pointer-events: none; width: max-content;
        }
        .history-item:hover .delete-btn { opacity: 1; } 
        
        /* ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .delete-btn {
            color: #e74c3c;
            cursor: pointer;
            opacity: 0; 
            transition: opacity 0.2s;
            padding-left: 10px;
        }
        .item-content { 
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { flex: 1; display: flex; flex-direction: column; background: var(--bg-color); position: relative; }
        .top-header { height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; border-bottom: 1px solid var(--border-color); background: var(--sidebar-bg); }
        .brand-title { font-size: 16px; font-weight: 700; color: var(--accent-color); display: flex; align-items: center; gap: 8px; }
        .header-controls { display: flex; align-items: center; gap: 20px; }
        .user-profile { cursor: pointer; display: flex; align-items: center; gap: 8px; position: relative; }
        .user-dropdown { position: absolute; top: 100%; right: 0; margin-top: 10px; background: var(--sidebar-bg); border: 1px solid var(--border-color); border-radius: 8px; width: 220px; display: none; flex-direction: column; z-index: 101; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .user-dropdown.active { display: flex; }

        /* ì±„íŒ… & ë¬¸ì„œ ë¶„í•  ì˜ì—­ */
        .split-container { flex: 1; display: flex; overflow: hidden; padding-bottom: 80px; position: relative; }
        
        /* 1. ì™¼ìª½: ì±„íŒ… ì˜ì—­ (ëˆ„ì ë¨) */
        .chat-panel { flex: 1; padding: 30px; overflow-y: auto; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
        
        /* ì§ˆë¬¸ ë¸”ëŸ­ (Fly Up Animation) */
        .chat-message.user {
            align-self: flex-end; /* ğŸš© ì˜¤ë¥¸ìª½ ì •ë ¬ */
            max-width: 70%;      /* ğŸš© ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
            background: var(--user-bubble-bg);
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            animation: flyUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .chat-message.user:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-color: var(--accent-color); }
        .chat-message.user .msg-label { font-size: 12px; color: #666; margin-bottom: 5px; font-weight: bold; text-align: right; }
        .chat-message.user .msg-text { text-align: left; } /* í…ìŠ¤íŠ¸ëŠ” ë‹¤ì‹œ ì™¼ìª½ ì •ë ¬ */
        
        /* AI ë‹µë³€ ë¸”ëŸ­: ì™¼ìª½ ì •ë ¬ ìœ ì§€ */
        .chat-message.ai {
            align-self: flex-start; /* ì™¼ìª½ ì •ë ¬ ìœ ì§€ */
            width: 100%;
            padding: 10px 20px;
            background: var(--ai-bubble-bg);
            line-height: 1.7;
        }
        .ai-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; color: var(--accent-color); font-weight: 700; font-size: 15px; }
        .cursor { display: inline-block; width: 2px; height: 1em; background: var(--text-color); animation: blink 1s infinite; }

        @keyframes flyUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 50% { opacity: 0; } }

        /* ğŸš© âœ… [ì‹ ê·œ] AI Thinking Motion Style */
        .chat-message.thinking {
            align-self: flex-start;
            width: 80px; /* ì‘ê²Œ */
            padding: 10px 15px;
            border-radius: 18px;
            background: #e0f2f1; /* ì—°í•œ ì²­ë¡ìƒ‰ ë°°ê²½ */
        }
        .typing-dots {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: var(--accent-color);
            border-radius: 50%;
            opacity: 0.3;
            animation: pulse-dot 1.5s infinite ease-in-out;
        }
        .dot:nth-child(2) { animation-delay: 0.5s; }
        .dot:nth-child(3) { animation-delay: 1s; }
        /* ë¶„ìœ„ê¸° ìˆëŠ” ì ë©¸ê³¼ ìƒ‰ìƒ ë³€í™” íš¨ê³¼ */
        @keyframes pulse-dot {
            0% { transform: scale(1); opacity: 0.3; background-color: var(--accent-color); }
            50% { transform: scale(1.4); opacity: 1; background-color: #4CAF50; } /* ì´ˆë¡ìƒ‰ */
            100% { transform: scale(1); opacity: 0.3; background-color: #2196F3; } /* íŒŒë€ìƒ‰ */
        }
        /* ğŸš© âœ… [ì‹ ê·œ] ë */

        /* 2. ì˜¤ë¥¸ìª½: ë¬¸ì„œ ì˜ì—­ */
        .doc-panel { flex: 1; padding: 30px; overflow-y: auto; background: rgba(0,0,0,0.02); }
        .doc-panel-title { font-size: 16px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; color: #555; }
        body.dark .doc-panel-title { color: #ccc; }
        
        .result-card { background: var(--card-bg); border-radius: 10px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 4px solid var(--accent-color); transition: 0.2s; }
        .result-card:hover { transform: translateX(5px); }
        .result-title { font-weight: bold; margin-bottom: 5px; font-size: 15px; }
        .result-meta { font-size: 12px; color: #888; margin-bottom: 5px; }
        .clickable-path { color: var(--accent-color); text-decoration: underline; cursor: pointer; font-size: 12px; word-break: break-all; }

        /* í•˜ë‹¨ ê²€ìƒ‰ì°½ */
        .bottom-search-bar { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(to top, var(--bg-color) 80%, transparent); display: flex; justify-content: center; z-index: 50; }
        .search-wrapper { width: 100%; max-width: 800px; position: relative; }
        .main-input { width: 100%; padding: 18px 60px 18px 25px; border-radius: 30px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color); font-size: 16px; outline: none; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .send-btn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: var(--accent-color); border: none; width: 40px; height: 40px; border-radius: 50%; color: white; cursor: pointer; transition: 0.2s; }
        .send-btn:hover { transform: translateY(-50%) scale(1.1); }
        /* ë¹„í™œì„±í™” ìƒíƒœ */
        .send-btn:disabled { background: #ccc; cursor: not-allowed !important; opacity: 0.7; }


        /* ìƒˆ ì±„íŒ… ì• ë‹ˆë©”ì´ì…˜ìš© í´ë˜ìŠ¤ */
        .shrink-animation { animation: shrinkToSidebar 0.8s forwards ease-in-out; }
        @keyframes shrinkToSidebar {
            0% { transform: scale(1) translate(0, 0); opacity: 1; }
            50% { transform: scale(0.4) translate(-40%, -40%); opacity: 0.5; }
            100% { transform: scale(0.1) translate(-100%, -100%); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="auth-layer" class="auth-wrapper">
        <div id="login-box" class="auth-box">
            <h2 style="color:var(--accent-color);">ë¬¸ì„œíƒìƒ‰ ì‹œìŠ¤í…œ</h2><br>
            <input type="text" id="loginId" class="auth-input" placeholder="ì‚¬ë²ˆ (ì•„ì´ë””)">
            <input type="password" id="loginPw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="btn-primary" onclick="checkLogin()">ë¡œê·¸ì¸</button>
            <button class="btn-secondary" onclick="showSignup()">íšŒì›ê°€ì…</button>
        </div>
        <div id="signup-box" class="auth-box hidden">
            <h2 style="color:var(--accent-color);">íšŒì›ê°€ì…</h2><br>
            <div style="display:flex; gap:5px;">
                <input type="text" id="signupId" class="auth-input" placeholder="ì•„ì´ë”” (@cnhxo.com ì œì™¸)">
                <button style="width:100px; height:42px; background:#666; color:white; border:none; border-radius:8px; cursor:pointer;" onclick="reqCode()">ì¸ì¦ìš”ì²­</button>
            </div>
            <div id="verify-area" class="hidden" style="margin-top:10px;">
                <input type="text" id="verifyCode" class="auth-input" placeholder="ì¸ì¦ì½”ë“œ 6ìë¦¬">
                <input type="password" id="newPw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì„¤ì •">
                <button class="btn-primary" onclick="doRegister()">ê°€ì…ì™„ë£Œ</button>
            </div>
            <button class="btn-secondary" onclick="showLogin()">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="main-app" class="app-layout hidden">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-bars sidebar-toggle-btn" onclick="toggleSidebar()"></i>
            </div>
            <button class="new-chat-btn" onclick="archiveCurrentChat()">
                <i class="fas fa-plus"></i> <span>ìƒˆ ì±„íŒ…</span>
            </button>
            <div class="history-list" id="history-list"></div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <div class="brand-title">
                    <i class="fas fa-star-of-life" style="font-size:20px;"></i>
                    HMO AI ë¬¸ì„œíƒìƒ‰
                </div>
                <div class="header-controls">
                    <div onclick="toggleTheme()" style="cursor:pointer;"><i class="fas fa-moon" id="theme-icon"></i></div>
                    <div style="font-weight:bold; color:#e74c3c;" id="timer">20:00</div>
                    <div class="user-profile" onclick="toggleUserMenu()">
                        <i class="fas fa-user-circle" style="font-size:24px;"></i>
                        <span id="display-username">User</span>
                        <div class="user-dropdown" id="user-dropdown">
                            <div style="padding:15px; border-bottom:1px solid #eee; font-size:13px; color:#888;">
                                <span id="full-email">user@cnhxo.com</span>
                            </div>
                            <button style="width:100%; padding:12px; color:#e74c3c; background:none; border:none; text-align:left; cursor:pointer;" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                        </div>
                    </div>
                </div>
            </header>

            <div class="split-container" id="workspace">
                
                <div class="chat-panel" id="chat-container">
                    <div style="text-align:center; color:#999; margin-top:50px;" id="welcome-msg">
                        <i class="fas fa-search" style="font-size:40px; margin-bottom:15px; color:#ddd;"></i><br>
                        ë¬¸ì„œ íƒìƒ‰ì„ ì‹œì‘í•˜ë ¤ë©´ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.
                    </div>
                </div>

                <div class="doc-panel" id="doc-container">
                    <div class="doc-panel-title"><i class="fas fa-file-alt"></i> ê´€ë ¨ ë¬¸ì„œ</div>
                    <div id="doc-results">
                        <div style="color:#888; font-size:14px; margin-top:10px;">
                            ì§ˆë¬¸ì„ ì…ë ¥í•˜ê±°ë‚˜ ì™¼ìª½ ì±„íŒ…ì˜ ì§ˆë¬¸ì„ í´ë¦­í•˜ë©´<br>ê´€ë ¨ëœ ë¬¸ì„œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>

            <div class="bottom-search-bar">
                <div class="search-wrapper">
                    <input type="text" id="mainInput" class="main-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                    <button class="send-btn" onclick="performSearch()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/index.js"></script>
</body>
</html>
